(window.__LOADABLE_LOADED_CHUNKS__=window.__LOADABLE_LOADED_CHUNKS__||[]).push([["FlashlightPageDesktop"],{"/eLK":function(e,t,n){"use strict";n.r(t);var r=n("GyhR"),o=n.n(r),a=n("ckdM"),i=n("Ivf5"),c=n("Yu3F"),s=n("Qo1m"),l=n("JsRk"),u=n("+U6O"),p=n("9Y9K");var h=Object(p.compose)(Object(i.connect)((function(e){return{hasHistory:e.history.previous.length>=1}})),l.withRouter)((function(e){var t=e.hasHistory,n=e.pinId,r=e.router;return o.a.createElement(c.a,{accessibilityLabel:s.a._("Go back","Accessible icon for close button"),bgColor:"transparent",hoverBgColor:"lightGray",onClick:function(){t?r.goBack():r.replace("/pin/".concat(n,"/"))}},o.a.createElement(u.c,{display:"flex",alignItems:"center",justifyContent:"center"},o.a.createElement(u.c,{padding:1},o.a.createElement(u.n,{icon:"arrow-back",color:"darkGray",inline:!0,accessibilityLabel:"",size:20})),o.a.createElement(u.c,{padding:1,marginRight:2},o.a.createElement(u.K,{bold:!0,color:"darkGray",size:"md"},s.a._("Pin","Back button from visual search to pin closeup")))))})),f=n("PNko"),_=n.n(f),E=n("NmcB");function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e){return(m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=10,b=48,v=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=m(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==O(o)&&"function"!=typeof o?y(r):o,S(y(y(n)),"state",{cropArea:n.props.initialCropArea||{h:0,w:0,x:0,y:0},cropChangeType:null,showShadowOverlay:!0}),S(y(y(n)),"cropResizeDirection",null),S(y(y(n)),"_checkCropHandleValid",(function(e,t){var r=n.state.cropArea,o=r.h,a=r.w,i=r.x,c=r.y;switch(n.cropResizeDirection){case"ne":e<i&&t>c+o?n.cropResizeDirection="sw":e<i?n.cropResizeDirection="nw":t>c+o&&(n.cropResizeDirection="se");break;case"nw":e>i+a&&t>c+o?n.cropResizeDirection="se":e>i+a?n.cropResizeDirection="ne":t>c+o&&(n.cropResizeDirection="sw");break;case"se":e<i&&t<c?n.cropResizeDirection="nw":e<i?n.cropResizeDirection="sw":t<c&&(n.cropResizeDirection="ne");break;case"sw":e>i+a&&t<c?n.cropResizeDirection="ne":e>i+a?n.cropResizeDirection="se":t<c&&(n.cropResizeDirection="nw")}})),S(y(y(n)),"handleOnTouchStart",(function(e){if(e.preventDefault(),e.stopPropagation(),e.target){var t=e.touches[0],r=t.clientX,o=t.clientY;n.handleOnPointerDown(e,r,o)}})),S(y(y(n)),"handleOnMouseDown",(function(e){if(e.preventDefault(),e.stopPropagation(),e.target){var t=e.clientX,r=e.clientY;n.handleOnPointerDown(e,t,r)}})),S(y(y(n)),"handleOnPointerDown",(function(e,t,r){var o=e.target,a=n.state.showShadowOverlay,i=n._cropperOverlay.getBoundingClientRect();n._cropperOverlayCoor={x:i.left,y:i.top};var c=t-n._cropperOverlayCoor.x,s=r-n._cropperOverlayCoor.y;if(o.className.includes("cropperHandle")){n.setState({cropChangeType:"resize"});var l=o.className;l.includes("ne")&&(n.cropResizeDirection="ne"),l.includes("nw")&&(n.cropResizeDirection="nw"),l.includes("se")&&(n.cropResizeDirection="se"),l.includes("sw")&&(n.cropResizeDirection="sw")}else o.className.includes("cropSection")?(n.setState({cropChangeType:"move"}),n.cropChangeStartCoor={x:c,y:s}):!o.className.includes("shadowMask")&&a||(n.cropChangeStartCoor={x:c,y:s},n.setState({cropArea:{h:0,w:0,x:c,y:s},cropChangeType:"select",showShadowOverlay:!0}))})),S(y(y(n)),"handleOnTouchMove",(function(e){return n._cropperOverlayCoor&&n.handleOnPointerMove(e.touches[0].clientX,e.touches[0].clientY)})),S(y(y(n)),"handleOnMouseMove",(function(e){return n._cropperOverlayCoor&&n.handleOnPointerMove(e.clientX,e.clientY)})),S(y(y(n)),"handleOnPointerMove",(function(e,t){var r=n.state,o=r.cropArea,a=o.h,i=o.w,c=o.x,s=o.y,l=r.cropChangeType,u=n.props.imageSize,p=e-n._cropperOverlayCoor.x,h=t-n._cropperOverlayCoor.y;if("resize"===l){var f=Math.max(Math.min(p,u.w-T),T),_=Math.max(Math.min(h,u.h-T),T);switch(n._checkCropHandleValid(f,_),n.cropResizeDirection){case"ne":var E=Math.max(a+(s-_),b),O=Math.max(Math.abs(f-c),b);n.setState({cropArea:{h:E,w:O,x:c,y:E<=b?s:_}});break;case"nw":var d=Math.max(i+(c-f),b),m=Math.max(a+(s-_),b);n.setState({cropArea:{h:m,w:d,x:d===b?c:f,y:m===b?s:_}});break;case"se":var I=Math.max(Math.abs(_-s),b),y=Math.max(Math.abs(f-c),b);n.setState({cropArea:{h:I,w:y,x:c,y:s}});break;case"sw":var S=Math.max(Math.abs(_-s),b),v=Math.max(i+(c-f),b);n.setState({cropArea:{h:S,w:v,x:v===b?c:f,y:s}})}}else if("move"===l){var g=p-n.cropChangeStartCoor.x,R=h-n.cropChangeStartCoor.y,C=Math.max(Math.min(c+g,u.w-i-T),T),N=Math.max(Math.min(s+R,u.h-a-T),T);n.cropChangeStartCoor={x:p,y:h},n.setState({cropArea:{h:a,w:i,x:C,y:N}})}else if("select"===l){var P=Math.max(Math.min(p,u.w),0),w=Math.max(Math.min(h,u.h),0),A=P-n.cropChangeStartCoor.x,D=w-n.cropChangeStartCoor.y;n.setState({cropArea:{h:Math.abs(D),w:Math.abs(A),x:Math.min(n.cropChangeStartCoor.x,P),y:Math.min(n.cropChangeStartCoor.y,w)}})}})),S(y(y(n)),"handleOnMouseUp",(function(e){return n.handleOnPointerUp()})),S(y(y(n)),"handleOnTouchEnd",(function(e){return n.handleOnPointerUp()})),S(y(y(n)),"handleOnPointerUp",(function(){var e=n.state.cropChangeType;"resize"!==e&&"move"!==e&&"select"!==e||n.handleCrop(),n.cropResizeDirection=null})),n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){this._cropperOverlay&&document.body&&(window.addEventListener("mouseup",this.handleOnMouseUp),document.body.addEventListener("mousemove",this.handleOnMouseMove),this._cropperOverlay.addEventListener("mousedown",this.handleOnMouseDown))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.initialCropArea&&(this.props.initialCropArea&&e.initialCropArea.h===this.props.initialCropArea.h&&e.initialCropArea.w===this.props.initialCropArea.w&&e.initialCropArea.x===this.props.initialCropArea.x&&e.initialCropArea.y===this.props.initialCropArea.y||this.setState({cropArea:e.initialCropArea}))}},{key:"componentWillUnmount",value:function(){this._cropperOverlay&&document.body&&(window.removeEventListener("mouseup",this.handleOnMouseUp),document.body.removeEventListener("mousemove",this.handleOnMouseMove),this._cropperOverlay.removeEventListener("mousedown",this.handleOnMouseDown))}},{key:"handleCrop",value:function(){var e=this.props,t=e.imageSize,n=e.onChange,r=this.state,o=r.cropChangeType,a=r.cropArea;if(0===a.w&&0===a.h)this.setState({showShadowOverlay:!1,cropChangeType:null}),n({origCrop:{h:t.h-2*T,w:t.w-2*T,x:T,y:T}});else{this.setState({showShadowOverlay:!0,cropChangeType:null});var i,c,s=Math.max(Math.min(a.x,t.w-b-T),T),l=Math.max(Math.min(a.y,t.h-b-T),T);switch(i=a.h<b?b:l+a.h>t.h-T?t.h-l-T:a.h,c=a.w<b?b:s+a.w>t.w-T?t.w-s-T:a.w,o){case"move":Object(E.a)(7603,{view:72});break;case"resize":Object(E.a)(7604,{view:72})}n({origCrop:{h:i,w:c,x:s,y:l}})}}},{key:"render",value:function(){var e=this,t=this.props,n=t.isFancy,r=t.imageSize,a=r.h,i=r.w,c=t.children,s=this.state,l=s.cropArea,u=l.h,p=l.w,h=l.x,f=l.y,E=s.cropChangeType,O=s.showShadowOverlay,d=_()("shadowOverlay","absolute",{shadowOverlayHide:!O}),m=n?"fancy":"";return o.a.createElement("div",{onTouchMove:this.handleOnTouchMove,onTouchEnd:this.handleOnTouchEnd},o.a.createElement("div",{className:"cropperWrapper block"},o.a.createElement("div",{className:"relative",ref:function(t){e._cropperOverlay=t},onTouchStart:this.handleOnTouchStart},o.a.createElement("div",{className:"cropSection absolute ".concat(n?"fancy":""),style:{height:u,left:h,top:f,width:p}},"select"!==E&&O&&o.a.createElement("div",null,o.a.createElement("div",{className:"cropperHandle absolute ord-nw ".concat(m)}),o.a.createElement("div",{className:"cropperHandle absolute ord-ne ".concat(m)}),o.a.createElement("div",{className:"cropperHandle absolute ord-sw ".concat(m)}),o.a.createElement("div",{className:"cropperHandle absolute ord-se ".concat(m)}))),o.a.createElement("div",{className:d},o.a.createElement("div",{className:"shadowMask absolute",style:{height:f,left:0,top:0,width:"100%"}}),o.a.createElement("div",{className:"shadowMask absolute",style:{height:u,left:0,top:f,width:h}}),o.a.createElement("div",{className:"shadowMask absolute",style:{height:a-f-u,left:0,top:f+u,width:"100%"}}),o.a.createElement("div",{className:"shadowMask absolute",style:{height:u,left:h+p,top:f,width:i-h-p}})),o.a.createElement("div",{className:"absolute cropperAdditional"},c))))}}])&&d(n.prototype,r),a&&d(n,a),t}(o.a.Component),g=n("ykrh");function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){var t=e.showAnimation,n=e.auxData,a=e.index,i=e.onClick,c=e.spotlightCenter;Object(r.useEffect)((function(){Object(E.a)(120,R({view:72,viewParameter:3050,element:1260},n))}),[]);var s=parseFloat((.1*(a+1)).toFixed(2)),l={animation:t?"spotlightDotPop 0.6s ease-out ".concat(s,"s both"):"none"};return o.a.createElement(g.a,{x:c.x,y:c.y,onClick:function(e){e&&(e.stopPropagation(),e.preventDefault()),Object(E.a)(101,R({view:72,viewParameter:3050,element:1260},n)),i(a)},style:l})}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){w(e,t,n[t])}))}return e}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=15;function D(e){var t=e.auxData,n=e.index,a=e.onClick,i=e.spotlightCenter;return Object(r.useEffect)((function(){Object(E.a)(120,P({view:72,viewParameter:3050,element:1260},t))}),[]),o.a.createElement("button",{className:"absolute no-border p0 spotlightButton",key:n,onClick:function(e){e&&(e.stopPropagation(),e.preventDefault()),Object(E.a)(101,P({view:72,viewParameter:3050,element:1260},t)),a(n)},style:{left:i.x,top:i.y,backgroundColor:"transparent"}},o.a.createElement(u.u,{height:A,shape:"circle",width:A},o.a.createElement("div",{className:"bg-white",style:{height:A,width:A,cursor:"pointer"}})))}var M=n("UmN8"),L=function(e){var t=e.showAnimation,n=e.pinId,r=e.imageSignature,a=e.imageSize,i=e.currentSpotlightIdx,c=e.spotlightAreas,s=e.handleSpotlightClick;return o.a.createElement(M.a,{name:"web_flashlight_improvements_v1"},(function(e){var l=e.group;return c.map((function(e,c){if(c===i)return null;var u=V({cropArea:e,imageSize:a}),p={x:u.x+u.w/2,y:u.y+u.h/2},h={pin_id:n,image_signature:r,visual_objects:JSON.stringify([{x:e.x,y:e.y,w:e.w,h:e.h}])},f="".concat(p.x).concat(p.y);return["enabled_dots","employees"].includes(l)?o.a.createElement(N,{showAnimation:t,auxData:h,index:c,key:f,onClick:s,spotlightCenter:p}):o.a.createElement(D,{auxData:h,index:c,key:f,onClick:s,spotlightCenter:p})}))}))},x=n("ggpB");function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function B(e){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function G(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=function(e,t){return Object.keys(e).reduce((function(n,r){return n+Math.abs(e[r]-t[r])}),0)<=4},V=function(e){var t=e.cropArea,n=e.imageSize,r=t.h,o=t.w,a=t.x,i=t.y;return{h:Math.floor(r*n.h),w:Math.floor(o*n.w),x:Math.floor(a*n.w),y:Math.floor(i*n.h)}},z=function(e){function t(e){var n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=this,o=B(t).call(this,e),n=!o||"object"!==j(o)&&"function"!=typeof o?G(r):o,H(G(G(n)),"handleChange",(function(e){var t=e.origCrop;(0,n.props.onChange)({origCrop:t,cropSource:he.CUSTOM_CROP})})),H(G(G(n)),"handleSpotlightClick",(function(e){var t=n.props,r=t.imageSize,o=t.onChange,a=t.spotlightAreas;o({origCrop:V({cropArea:a[e],imageSize:r}),cropSource:he.SPOTLIGHT_DOT})}));var a=n.props,i=a.imageSize,c=a.initialCropArea,s=a.spotlightAreas.findIndex((function(e){return F(c,V({cropArea:e,imageSize:i}))}));return n.state={currentSpotlightIdx:s},n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(t,e),n=t,(r=[{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.imageSize,n=e.initialCropArea,r=e.spotlightAreas.findIndex((function(e){return F(n,V({cropArea:e,imageSize:t}))}));this.setState({currentSpotlightIdx:r})}},{key:"render",value:function(){var e=this,t=this.props,n=t.showAnimation,r=t.imageSize,a=t.initialCropArea,i=t.spotlightAreas,c=t.imageSignature,s=t.pinId,l=this.state.currentSpotlightIdx,u=i&&!!i.length;return o.a.createElement(M.a,{name:"web_flashlight_improvements_v1"},(function(t){var p=t.group;return o.a.createElement(v,{imageSize:r,initialCropArea:a,isFancy:["enabled_cropper","employees"].includes(p),onChange:e.handleChange,onContextMenu:function(e){e.stopPropagation(),Object(x.a)("auth.context_menu_open.pin_visual_search")}},u&&o.a.createElement(L,{showAnimation:n,pinId:s,imageSignature:c,imageSize:r,currentSpotlightIdx:l,spotlightAreas:i,handleSpotlightClick:e.handleSpotlightClick}))}))}}])&&k(n.prototype,r),a&&k(n,a),t}(r.Component);H(z,"defaultProps",{spotlightAreas:[]});var Y=n("mzhd"),W=n("Y2BC"),K=n("3KWM");function X(e){return(X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e){return(Z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function J(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var $=function(e){function t(){var e,n,r,a,i,c,s;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var l=arguments.length,u=new Array(l),p=0;p<l;p++)u[p]=arguments[p];return r=this,a=(e=Z(t)).call.apply(e,[this].concat(u)),n=!a||"object"!==X(a)&&"function"!=typeof a?J(r):a,i=J(J(n)),s=function(e){var t=e.data,r=e.itemIdx,a=n.props,i=a.resourceOptions.image_signature,c=a.visualLiveSearchResource,s=c&&c.data&&c.data.search_identifier;return o.a.createElement(Y.a,{contextLogData:{viewData:{search_identifier:s},search_identifier:s,image_signature:i},pin:t,slotIndex:r,surface:"FlashlightResultGrid",viewParameter:3050,viewType:72})},(c="renderItem")in i?Object.defineProperty(i,c,{value:s,enumerable:!0,configurable:!0,writable:!0}):i[c]=s,n}var n,r,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,e),n=t,(r=[{key:"componentDidMount",value:function(){var e=this.props,t=e.visualLiveSearchResource,n=e.onSearchIdChange,r=t&&t.data&&t.data.search_identifier;r&&n(r)}},{key:"componentDidUpdate",value:function(e){var t=e.visualLiveSearchResource.data,n=this.props.visualLiveSearchResource.data,r=n&&n.search_identifier,o=t&&t.search_identifier;r&&r!==o&&this.props.onSearchIdChange(r)}},{key:"render",value:function(){var e=this.props.visualLiveSearchResource,t=e.data,n=e.isFetching,r=e.fetchMore,a=t&&t.results,i=t&&t.search_identifier;return o.a.createElement(u.c,null,a&&i&&o.a.createElement(u.c,null,o.a.createElement(u.v,{columnWidth:K.e,comp:this.renderItem,gutterWidth:K.d,items:a,loadItems:r,minCols:1,scrollContainer:function(){return window}})),o.a.createElement(u.G,{accessibilityLabel:s.a._("Loading search results...","Accessibility label for loading visual search results"),show:n||!i}))}}])&&Q(n.prototype,r),a&&Q(n,a),t}(r.PureComponent),ee=Object(p.compose)(Object(W.b)({name:"VisualLiveSearchResource",options:function(e){return e.resourceOptions},key:"visualLiveSearchResource"}))($),te=n("Q6EP"),ne=n.n(te),re=n("8rWZ"),oe=n("V+Hv");function ae(e){return(ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ie(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){pe(e,t,n[t])}))}return e}function pe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var he={SPOTLIGHT_DOT:1,STELA_DOT:4,DEFAULT_CROP:5,CUSTOM_CROP:6},fe=function(e,t,n){var r=e.x,o=e.y,a=e.w,i=e.h,c=[];return r>=0&&o>=0&&a>=0&&i>=0&&(c=c.concat(["x=".concat(r),"y=".concat(o),"w=".concat(a),"h=".concat(i)])),n&&(c=c.concat("cropSource=".concat(n))),c.length?"?".concat(c.join("&")):""},_e=function(e,t,n){var r=fe(e,t,n);return"/pin/".concat(t,"/visual-search/").concat(r)},Ee=function(e){var t=e.images,n=e.image_signature,r=t["564x"]&&t.orig,o=r.url,a=r.width,i=r.height;return a>564&&(i*=564/a,a=564),{width:a,height:i,url:o,imageSignature:n}},Oe=function(e){var t,n=e.initialCropArea,r=e.pin;if(n)t=ue({},n);else{var o=r.visual_objects,a=Ee(r),i=a.width,c=a.height;if(o&&o.length){var s=o[0],l=s.x,u=s.y,p=s.w,h=s.h,f=[l*i,u*c,p*i,h*c];t={x:l=f[0],y:u=f[1],w:p=f[2],h:h=f[3]}}else{var _=i/6,E=c/6;t={x:_,y:E,w:i-2*_,h:c-2*E}}}return{x:Math.floor(t.x),y:Math.floor(t.y),w:Math.floor(t.w),h:Math.floor(t.h)}},de=0,me="",Ie=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,i=new Array(a),c=0;c<a;c++)i[c]=arguments[c];return r=this,o=(e=ce(t)).call.apply(e,[this].concat(i)),n=!o||"object"!==ae(o)&&"function"!=typeof o?le(r):o,pe(le(le(n)),"state",{searchId:""}),pe(le(le(n)),"getResourceOptions",(function(e){var t=e.pin,n=e.cropArea,r=e.width,o=e.height,a=e.cropSource;return{pin_id:t.id,image_signature:t.image_signature,crop:{x:n.x/r,y:n.y/o,w:n.w/r,h:n.h/o},crop_source:a}})),pe(le(le(n)),"saveFlashlightImageContainerRef",(function(e){n.flashlightImageContainerRef=e})),pe(le(le(n)),"handleCropperChange",(function(e){var t=e.origCrop,r=e.cropSource,o=n.props,a=o.pinId,i=o.router;_e(t,a,r)!==window.location.pathname+window.location.search&&i.replace({pathname:"/pin/".concat(a,"/visual-search/"),query:ue({},t,{cropSource:r}),search:fe(t,a,r),state:{internalNavigation:!0}})})),pe(le(le(n)),"handleSearchIdChange",(function(e){n.setState({searchId:e})})),n}var n,i,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&se(e,t)}(t,e),n=t,(i=[{key:"componentDidMount",value:function(){var e=this.props,t=e.initialCropArea,n=e.pinResource.data,r=e.pinId,o=e.router;if(!t&&n){var a=Oe({initialCropArea:t,pin:n}),i=_e(a,r);o.replace(i)}this.flashlightImageContainerRef&&me===r&&(this.flashlightImageContainerRef.scrollTop=de),Object(E.a)(13,{view:72,viewParameter:3050,viewData:{pin_id:r}})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){ne()(e.initialCropArea,this.props.initialCropArea)||this.setState({searchId:""})}},{key:"componentWillUnmount",value:function(){var e=this.props.pinId;this.flashlightImageContainerRef&&(de=this.flashlightImageContainerRef.scrollTop,me=e)}},{key:"renderSpinner",value:function(){return o.a.createElement(u.G,{accessibilityLabel:s.a._("Loading visual search...","Accessibility label for loading visual search page"),show:!0})}},{key:"renderFlashlight",value:function(){var e=this,t=this.props,n=t.pinResource.data,i=t.initialCropArea,c=t.initialCropSource,l=t.router;if(!n)return null;var p=Ee(n),f=p.width,_=p.height,E=p.url,O=Oe({initialCropArea:i,pin:n}),d=c||he.DEFAULT_CROP,m=this.getResourceOptions({pin:n,cropArea:O,width:f,height:_,cropSource:d}),I=f+20,y=!(l.location&&l.location.state&&l.location.state.internalNavigation);return o.a.createElement(r.Fragment,null,o.a.createElement(a.a,{position:"fixed",style:{width:"100%",zIndex:3,backgroundColor:"#ffffff"}},o.a.createElement(u.c,{width:"100%",paddingY:3,paddingX:9,display:"flex",alignItems:"center"},o.a.createElement(u.c,{dangerouslySetInlineStyle:{__style:{position:"absolute"}}},o.a.createElement(h,{pinId:n.id})),o.a.createElement(u.c,{flex:"grow"},o.a.createElement(M.a,{name:"web_flashlight_improvements_v1"},(function(e){var t=e.anyEnabled;return o.a.createElement(u.K,{size:"xl",bold:!0,align:"center"},t?s.a._("More Ideas","Header explaining results of flashlight search"):s.a._("Visually similar results","Header explaining results of flashlight search"))}))))),o.a.createElement(oe.a,null,(function(t){return o.a.createElement(u.c,{display:"flex",paddingX:12},o.a.createElement("div",{style:{position:"fixed",width:I,height:"inherit",overflow:"auto",top:t+60,bottom:0,marginBottom:10},ref:e.saveFlashlightImageContainerRef},o.a.createElement("div",{"data-test-id":"flashlight-enabled-image",style:{width:f,height:_}},o.a.createElement(u.u,{height:_,shape:"rounded",width:f},o.a.createElement(M.a,{name:"web_flashlight_improvements_v1"},(function(t){var r=t.anyEnabled;return o.a.createElement(z,{showAnimation:y,imageSignature:n.image_signature,imageSize:{h:_,w:f},initialCropArea:O,onChange:e.handleCropperChange,pinId:n.id,spotlightAreas:r?n.visual_objects&&n.visual_objects.slice(1)||[]:n.visual_objects})})),o.a.createElement(u.p,{alt:n.description,naturalHeight:_,naturalWidth:f,src:E})))),o.a.createElement("div",{style:{marginLeft:I+16,width:"100%",position:"relative",top:60}},o.a.createElement(ee,{resourceOptions:m,onSearchIdChange:e.handleSearchIdChange})))})))}},{key:"render",value:function(){var e=this.props.pinResource.isLoaded,t=this.state.searchId;return o.a.createElement(re.a,{view:72,objectId:t},o.a.createElement("div",null,e?this.renderFlashlight():this.renderSpinner()))}}])&&ie(n.prototype,i),c&&ie(n,c),t}(r.Component),ye=Object(p.compose)(l.withRouter,Object(W.b)({name:"PinResource",key:"pinResource",options:function(e){return{id:e.pinId,field_set_key:"detailed",fetch_visual_search_objects:!0}}}))(Ie),Se=n("owVk"),Te=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.every((function(e){return!isNaN(e)}))};t.default=Object(p.compose)(Object(Se.a)({name:"Flashlight",resourceDependencies:function(e,t){return[{name:"PinResource",options:{id:t.id,field_set_key:"detailed",fetch_visual_search_objects:!0}}]}}))((function(e){var t=e.params,n=e.location,r=t.id,a=n.query,i=parseInt(a.x,10),c=parseInt(a.y,10),s=parseInt(a.w,10),l=parseInt(a.h,10),u=parseInt(a.cropSource,10)||void 0;return o.a.createElement(ye,{pinId:r,initialCropArea:Te(i,c,s,l)?{x:i,y:c,w:s,h:l}:void 0,initialCropSource:u})}))},"8rWZ":function(e,t,n){"use strict";var r=n("GyhR"),o=n("0mUz"),a=n("ximl");t.a=function(e){return r.createElement(a.a,Object.assign({},e,{timeSpentManager:o.a}))}},AdUJ:function(e,t,n){"use strict";var r=n("GyhR");t.a=Object(r.createContext)(0)},QUnS:function(e,t,n){var r=n("SVx8"),o=n("9mHT"),a=n("MQR1"),i=9007199254740991,c=4294967295,s=Math.min;e.exports=function(e,t){if((e=a(e))<1||e>i)return[];var n=c,l=s(e,c);t=o(t),e-=c;for(var u=r(l,t);++n<e;)t(n);return u}},"V+Hv":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=n("GyhR"),o=n("AdUJ").a;function a(e){return(0,e.children)(Object(r.useContext)(o))}function i(){return Object(r.useContext)(o)}},ckdM:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("GyhR"),o=n.n(r),a=n("V+Hv");function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){c(e,t,n[t])}))}return e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=e.children,n=e.className,r=e.forwardRef,c=e.position,s=e.style,l=void 0===s?{}:s,u=Object(a.b)();return o.a.createElement("div",{className:n,ref:r,style:i({top:u},c?{position:c}:{},l)},t)}},dsNV:function(e,t){e.exports={ReasonToChoose:{UNKNOWN:0,REPIN_BOARD:1,RECOMMENDED_CATEGORY:2,COOKIE_MONSTER:3,USER_ACTIVITY:4,FOLLOWED_INTEREST:5,RECENT_FOLLOWED_INTEREST:59,REALTIME_P2B:6,REALTIME_P2B_CLOSEUP:22,RECOMMENDED_INTEREST:7,VISUALLY_SIMILAR:8,CLICKTHROUGH:9,BOARD_FOLLOW:35,RECENT_FOLLOWED_BOARD:61,USER_FOLLOW:45,RECOMMENDED_COMMERCE:10,EVERYTHING_FEED:11,RECOMMENDED_LOCAL_PIN:12,LOCAL_REPIN_BOARD:13,SEARCH:46,P2P:14,PROMOTED_PIN:15,P2P_USER_COMMERCE:16,COMMERCE_EDUCATION:17,LANDING_PAGE_PINS:18,FOLLOWING_FEED:19,POPULAR_FEED:20,P2P_COMMERCE:21,P2P_DYNAMIC_GRID:23,LANDING_PAGE_INTEREST_PINS:24,FRESH_PIN_FROM_PIN:25,FRESH_PIN_FROM_INTEREST:26,FRESH_PIN_FROM_BOARD:27,SIFTER_VIDEO_FROM_INTEREST:39,SIFTER_PRODUCTS:57,SIFTER_DISTRIBUTION_A:50,SIFTER_DISTRIBUTION_B:51,SIFTER_DISTRIBUTION_C:52,SIFTER_DISTRIBUTION_D:53,SIFTER_DISTRIBUTION_E:54,SIFTER_ACTIVATION_EXPERIMENT:58,SIFTER_FRESHMAKER_PIN_FROM_INTEREST:40,P2P_CLICKTHROUGH:28,P2P_CLOSEUP:29,P2P_LIKE:30,P2P_PIN_CREATE:31,LOCAL_CLICKTHROUGH:32,LOCAL_USER_ACTIVITY:33,INSTANT_PFY:34,INSTANT_PFY_NON_MATERIALIZABLE:36,DYNAMIC_INSERTION:37,DYNAMIC_INSERTION_BOARD_FOLLOW:38,HYPERLOCAL_INTEREST_BOARD:41,NUX_BOARD_FOLLOW_P2P:42,INDIRECT_DOMAIN_PIN:43,PIXIE_PINS_FOR_BOARD:44,FRESH_REPIN_BOARD:47,FRESH_CLICKTHROUGH:48,FRESH_USER_ACTIVITY:49,SCREENSHOT_SAVE:55,TEXT_EMBEDDINGS:56,FRESH_TEXT_EMBEDDINGS:67,PREFETCH_LOAD:60,DIVERSE_TOPICS:62,QUIZ_RESULTS:63,INTENTIONAL_DISTRIBUTION_TOPICS:64,INTENTIONAL_DISTRIBUTION_TOPICS_THIRD_PARTY:90,INTENTIONAL_DISTRIBUTION_TOPICS_STORY_PINS:91,INTENTIONAL_DISTRIBUTION_TOPICS_VIDEO:98,INTENTIONAL_DISTRIBUTION_GEMINI:73,INTENTIONAL_DISTRIBUTION_GEMINI_V5:120,INTENTIONAL_DISTRIBUTION_SHOP_STYLE_STL:74,INTENTIONAL_DISTRIBUTION_GRAPHSAGE:78,INTENTIONAL_DISTRIBUTION_REPIN_BOARD:80,INTENTIONAL_DISTRIBUTION_CLICKTHROUGH:81,INTENTIONAL_DISTRIBUTION_USER_ACTIVITY:82,INTENTIONAL_DISTRIBUTION_DOMAIN:86,INTENTIONAL_DISTRIBUTION_CREATOR_BASELINE:92,INTENTIONAL_DISTRIBUTION_USER_TO_CREATOR_VIDEO:95,INTENTIONAL_DISTRIBUTION_USER_TO_CREATOR_STORY_PIN:100,INTENTIONAL_DISTRIBUTION_RECOMMENDED_TOPICS:102,INTENTIONAL_DISTRIBUTION_RECOMMENDED_TOPICS_STORY_PIN:103,INTENTIONAL_DISTRIBUTION_RECOMMENDED_TOPICS_DIVERSITY:105,RECOMMENDED_TOPICS:65,PIXIE_RECENT_ACTION:66,NATIVE_CONTENT_TOPICS:68,BUBBLE_OPEN_TOPICS:69,TOPIC_BEST_PINS:70,DARK_PROMOTED_PIN:71,POST_EXPLORE_TOPICS:72,GRAPHSAGE_EMBEDDINGS:75,DEMOGRAPHIC_PFY:76,TOPIC_BEST_PINS_V2:77,DAILY_BEST_PINS:79,SHOPPING_STL:83,UNAUTH_PIXIE_P2B:84,UNAUTH_PIXIE_P2P:85,VIDEO_EMBEDDINGS:87,VIDEO_EMBEDDINGS_GEMINI_V5:121,NAVBOOST_P2P:88,NAVBOOST_PFY:89,GEMINI_V5_EMBEDDINGS_STATIC:93,GEMINI_V5_EMBEDDINGS_FRESH:94,GEMINI_V5_EMBEDDINGS_REALTIME:106,GEMINI_V5_EMBEDDINGS_STORYPIN:107,CURATED_VIDEO_INTEREST:96,GRAPHSAGE_PRODUCT_PINS:97,GRAPHSAGE_PRODUCT_PINS_LONGER_HISTORY:112,NUX_GRAPHSAGE:99,TOPIC_BEST_PINS_V3:101,GEMINI_INTERESTS_FRESH:104,GRAPHSAGE_USER_EMBEDDINGS_TO_PINS:108,GRAPHSAGE_USER_EMBEDDINGS_TO_ORGANIC_PINS:109,GRAPHSAGE_USER_EMBEDDINGS_TO_PRODUCT_PINS:110,LENS_CAMERA_VISUALLY_SIMILAR:111,GRAPHSAGE_VIDEO_PINS:113,RECBOOST_REPIN_BOARD:114,RECBOOST_CLICKTHROUGH:115,RECBOOST_USER_ACTIVITY:116,RECOMMENDED_BOARDS:117,RECOMMENDED_CREATOR_BOARDS:124,INTENTIONAL_DISTRIBUTION_MANUAL_TAGGEED_INTERESTS_VIDEO:118,INTENTIONAL_DISTRIBUTION_MANUAL_INTERESTS_VIDEO:119,REPIN_CREATOR_BOARD:122,GRAPHSAGE_USER_EMBEDDINGS_TO_CREATOR_PINS:123,FRESH_SIG_FROM_BOARD:125,RTC_IMPROVEMENT_TEST_1:501,RTC_IMPROVEMENT_TEST_2:502,RTC_IMPROVEMENT_TEST_3:503,RTC_IMPROVEMENT_TEST_4:504,RTC_IMPROVEMENT_TEST_5:505,RTC_IMPROVEMENT_TEST_6:506,RTC_IMPROVEMENT_TEST_7:507,RTC_IMPROVEMENT_TEST_8:508,RTC_IMPROVEMENT_TEST_9:509,RTC_IMPROVEMENT_TEST_10:510,RTC_IMPROVEMENT_TEST_11:511,RTC_IMPROVEMENT_TEST_12:512,RTC_IMPROVEMENT_TEST_13:513,RTC_IMPROVEMENT_TEST_14:514,RTC_IMPROVEMENT_TEST_15:515}}},nCsZ:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n("ocw6");function o(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=Object(r.a)(e);return!isNaN(t)}},ocw6:function(e,t,n){"use strict";function r(e){if(arguments.length<1)throw new TypeError("1 argument required, but only "+arguments.length+" present");var t=Object.prototype.toString.call(e);return e instanceof Date||"object"==typeof e&&"[object Date]"===t?new Date(e.getTime()):"number"==typeof e||"[object Number]"===t?new Date(e):("string"!=typeof e&&"[object String]"!==t||"undefined"==typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}n.d(t,"a",(function(){return r}))},ykrh:function(e,t,n){"use strict";var r=n("GyhR"),o=n("Qo1m"),a=n("+U6O");function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h(e,t,n[t])}))}return e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(e){function t(){var e,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return r=this,o=(e=l(t)).call.apply(e,[this].concat(c)),n=!o||"object"!==i(o)&&"function"!=typeof o?p(r):o,h(p(p(n)),"state",{isHovering:!1}),h(p(p(n)),"handleMouseEnter",(function(){return n.setState({isHovering:!0})})),h(p(p(n)),"handleMouseLeave",(function(){return n.setState({isHovering:!1})})),n}var n,f,_;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(t,e),n=t,(f=[{key:"render",value:function(){var e=this.props,t=e.forwardedRef,n=e.icon,i=e.onClick,s=e.onMouseDown,l=e.onMouseUp,u=e.selected,p=e.style,h=e.text,f=e.x,_=e.y,E=e.zIndex,O=e.backdropDiameter,d=void 0===O?32:O,m=e.dotDiameter,I=void 0===m?16:m,y=this.state.isHovering?d+4:d,S={zIndex:E,position:"absolute",top:_-y/2,left:f-y/2,outline:"none"},T={backgroundColor:"rgba(0, 0, 0, 0.1)",width:y,height:y,border:"none",borderRadius:y,cursor:i?"pointer":"default"},b={backgroundColor:"#fff",boxShadow:u?"0 0 0 3px #e60023":"none",width:I,height:I,border:"none",borderRadius:I,position:"absolute",top:(y-I)/2,left:(y-I)/2,padding:0,display:"flex",alignItems:"center",justifyContent:"center"};return r.createElement("div",{onClick:i,onKeyPress:i,onMouseDown:s,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseUp:l,ref:t,role:"button",style:S,tabIndex:"0"},r.createElement("div",{style:c({},T,p)},r.createElement("div",{style:b},!!h&&r.createElement(a.K,{align:"center",color:"darkGray",size:"xs",bold:!0,inline:!0},h),n&&r.createElement(a.n,{accessibilityLabel:o.a._("Tag anchor","accessibility label for an anchor for an object in a pin"),color:"red",icon:n,size:I/2,inline:!0}))))}}])&&s(n.prototype,f),_&&s(n,_),t}(r.Component);t.a=r.forwardRef((function(e,t){return r.createElement(f,Object.assign({},e,{forwardedRef:t}))}))}},0,["ArticlePageDesktop~AuthHomePageDesktop~BoardPageContainerDesktop~BoardPageDesktop~BoardSectionPageDe~96007a1e","BoardSectionPageDesktop~ExperienceBizNuxContainer~ImagesFeedPageDesktop~PinBetterSaveCommon~PinBookm~58bd55d7","ExperienceBizNuxContainer~ImagesFeedPageDesktop~PinBetterSaveCommon~PinBookmarkletPageDesktop~PinFee~85d27636","CreateFlowSterling~PersistentOneClickSaveCommon~PinBetterSaveCommon~PinFeedbackPageDesktop~PinPersis~927303d1",20,"PersistentOneClickSaveCommon~PinBetterSaveCommon~PinFeedbackPageDesktop~PinPersistentOneClickSaveCom~5976c585",29,"PinBetterSaveCommon","PinFeedbackPageDesktop~PinSaveButtonCommon","PinSaveButtonCommon","PinRepEditButtonCommon","NuxOneClickSaveButtonCommon","PinPromoteButtonCommon","PinRepSendShareFlyoutButtonCommon","PinRepSendShareLinkButtonCommon"]]);
//# sourceMappingURL=pjs-FlashlightPageDesktop-7bd88933153844b4049a.js.map
